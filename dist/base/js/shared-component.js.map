{"version":3,"sources":["base/js/shared-component.js"],"names":["articleClassName","scrollToOffset","generateCatalog","article","document","getElementsByClassName","createElement","catalogNode","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","className","childNodes","node","_step","value","firstChild","before","insertCatalogItem","err","_iterator","return","catalogItem","nodeName","toLowerCase","innerHTML","textContent","appendChild","nodeTop","actualTop","offsetTop","parentNode","offsetParent","getNodeTop","scrollCheckPoints","push","top","addEventListener","window","scrollTo","watchProgress","progressBar","progress","scrollHandler","getScrollTop","totalScrollTop","body","clientHeight","innerHeight","rate","currentScrollTop","style","width","focusonCatalogItem","length","some","checkPoint","classList","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","Symbol","iterator","next","done","classItem","result","ifContentClass","console","log","forEach","remove","documentElement","scrollTop"],"mappings":"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","file":"base/js/shared-component.js","sourcesContent":["const articleClassName = \"output\"\nconst scrollToOffset = 30\nconst scrollCheckPoints = []\n\n/**\n * 左侧目录的生成代码\n */\nfunction generateCatalog() {\n    const article = document.getElementsByClassName(articleClassName)[0]\n    const catalogNode = document.createElement(\"div\")\n    catalogNode.className = \"catalog\"\n    article.firstChild.before(catalogNode)\n    for (let node of article.childNodes) {\n        switch (node.nodeName) {\n            case \"H1\":\n            case \"H2\":\n            case \"H3\":\n            case \"H4\":\n            case \"H5\":\n            case \"H6\":\n                insertCatalogItem(node)\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    function insertCatalogItem(node) {\n        const catalogItem = document.createElement(\"div\")\n        catalogItem.className = \"catalog-\" + node.nodeName.toLowerCase();\n        catalogItem.innerHTML = node.textContent\n        catalogNode.appendChild(catalogItem)\n\n        const nodeTop = getNodeTop(node)\n        scrollCheckPoints.push({\n            top: nodeTop,\n            catalogItem: catalogItem\n        })\n        catalogItem.addEventListener('click', () => {\n            window.scrollTo(0, nodeTop - scrollToOffset)\n        })\n    }\n\n\n    function getNodeTop(node) {\n        let actualTop = node.offsetTop;\n        let parentNode = node.offsetParent;\n\n        while (parentNode !== null) {\n            actualTop += parentNode.offsetTop\n            parentNode = parentNode.offsetParent\n        }\n\n        return actualTop\n    }\n}\n\ngenerateCatalog()\n\n/**\n * 进度条的控制代码\n */\nfunction watchProgress() {\n    const progressBar = document.createElement(\"div\")\n    progressBar.className = \"progress-bar\"\n\n    const progress = document.createElement(\"div\")\n    progress.className = \"progress\"\n\n    progressBar.appendChild(progress)\n    document.body.firstChild.before(progressBar)\n\n    if (progress) {\n        const scrollHandler = () => {\n            const currentScrollTop = getScrollTop()\n            const totalScrollTop = document.body.clientHeight - window.innerHeight\n            const rate = currentScrollTop / totalScrollTop\n            progress.style.width = rate * 100 + \"vw\"\n\n            if (totalScrollTop - currentScrollTop < 10) {\n                focusonCatalogItem(scrollCheckPoints[scrollCheckPoints.length - 1].catalogItem, \"catalog-item-focuson\")\n            } else {\n                scrollCheckPoints.some(checkPoint => {\n                    // 2: 避免临界值浮点数比较等情况\n                    if (currentScrollTop + scrollToOffset + 2 > checkPoint.top) {\n                        if (!ifContentClass(checkPoint.catalogItem.classList, \"catalog-item-focuson\")) {\n                            focusonCatalogItem(checkPoint.catalogItem, \"catalog-item-focuson\")\n                        }\n                        return false\n                    }\n                })\n            }\n        }\n\n        scrollHandler()\n\n        window.addEventListener('scroll', scrollHandler)\n        // window.addEventListener('touchmove', progressHandler)\n    }\n\n    function ifContentClass(classList, className) {\n        let result = false\n        for (const classItem of classList) {\n            if (className === classItem) {\n                result = true\n                break\n            }\n        }\n        if (result) console.log(123)\n        return result\n    }\n\n    function focusonCatalogItem(node, className) {\n        scrollCheckPoints.forEach(checkPoint => {\n            if (checkPoint.catalogItem === node) {\n                checkPoint.catalogItem.classList.add(className)\n            } else {\n                checkPoint.catalogItem.classList.remove(className)\n            }\n        })\n    }\n}\n\nfunction getScrollTop() {\n    return document.documentElement.scrollTop || document.body.scrollTop\n}\n\nwatchProgress()"]}